<!DOCTYPE html>
<html 
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

	<h:head>
		<title>Datenbank#{konfig.suffixTitle}</title>
		<f:metadata>
    		<f:viewAction action="#{weiterleitung.noAdmin}" />
		</f:metadata>
		<f:event type="preRenderView" listener="#{konfig.addHeader}" />
		<link rel="icon" type="image/png" href="#{resource['/img/favicon.png']}" />
		<h:outputStylesheet library="css" name="#{konfig.css}" />
		<h:outputStylesheet library="css" name="fileLink.css" />
		<h:outputScript library="js" name="topMenu.js" />
		<h:outputScript library="js" name="preview.js" />
		
		<style>
			.ui-selectcheckboxmenu-panel{
				width: 300px /* Primefaces-Bug */
			}
		</style>
	</h:head>
	
	<h:body style="background-color:#{themeService.backgroundColor};">
		<p:growl id="message" showDetail="true"/>
		
		<p:confirmDialog global="true">
			<div style="text-align:center">
				<p:commandButton value="Nein" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
				<p:commandButton value="Ja" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
			</div>
		</p:confirmDialog>
		
		<div id="hidden-div">
		
<!-- Side Menu -->
			<h:form style="position:fixed;">
				<p:menu model="#{sideMenu.model}" style="font-size:11pt;width:160px;"/>
			</h:form>
		
			<p:panel id="big-div" rendered="#{konfig.admin}">
					
<!-- Top Menu -->
				<h:form>
					<p:menubar styleClass="centeredMenuBar ui-widget-header ui-corner-all" model="#{topMenu.model}"
								style="top:0px;width:953px;position:fixed;transform: translateX(0%);z-index:+99;height:25px;" />
				</h:form>
					
				<br/><br/><br/>
				
				<h2 class="title" style="color:#4c4c4c;">Nutzerverwaltung</h2>
				
				<br/>
				
				<p:panel id="updateNutzer" header="Nutzerdaten verwalten">
					<br/>
					Hier können Sie Nutzerdatenbank durchsuchen und bearbeiten.
					<br/><br/>
					<div class="ui-g">
					    <div class="ui-g-6">
						    <h:form>
								<p:outputLabel value="Nutzer suchen:" style="font-weight: bold;" />
								<br/><br/>
								<h:panelGrid columns="2">
									Vorname:
									<p:inputText value="#{nutzerUpdate.critVorname}" />
									<br/>
									Nachname:
									<p:inputText value="#{nutzerUpdate.critNachname}" style="position:relative; top:10px"/>
									<br/>
									Klassenstufe:
									<p:inputText value="#{nutzerUpdate.critKlassenstufe}" style="position:relative; top:10px"/>
									<br/>
									Rang:
									<p:selectOneMenu value="#{nutzerUpdate.critRang}" style="width:200px; position:relative; top:10px" effect="none">
										<f:selectItem itemLabel="alle Ränge" itemValue="" noSelectionOption="false" />
										<f:selectItems value="#{nutzerUpdate.rang}" />
									</p:selectOneMenu>
									<br/>
								</h:panelGrid>
								<br/>
								<p:commandButton value="Suchen" action="#{nutzerUpdate.search}" update="updateNutzer message" icon="fa fa-search"
													onstart="PF('overlayLoad').show()" oncomplete="PF('overlayLoad').hide()"/>
								<p:commandButton value="Abbrechen" action="#{nutzerUpdate.cancel}" update="updateNutzer" rendered="#{nutzerUpdate.tabelle != null}" style="margin-left:20px" icon="fa fa-times" />
							</h:form>
					    </div>
					    <div class="ui-g-6">
						    <h:form>
								<p:outputLabel value="Funktionen:" style="font-weight: bold;" />
								<br/><br/>
								<p:commandButton value="Klassenstufe erhöhen" action="#{nutzerUpdate.incrementKlassenstufe}" update="updateNutzer message" icon="fa fa-arrow-up"/>
								<br/><br/>
								<p:commandButton value="Klassenstufe verringern" action="#{nutzerUpdate.decrementKlassenstufe}" update="updateNutzer message" icon="fa fa-arrow-down"/>
								<br/><br/>
								<p:commandButton value="Quotas klassenweise ändern" oncomplete="PF('overlayQuotasKlasse').show()" action="#{nutzerUpdate.prepareQuotasKlasse}" update="panelQuotasKlasse" icon="fa fa-hdd-o"/>
								<br/><br/>
								<p:commandButton value="ALLE Schüler/innen löschen" oncomplete="PF('overlayDeleteAllNutzer').show()" action="#{nutzerUpdate.prepareDeleteAccount}" update="panelDeleteAllNutzer" icon="fa fa-trash"/>
								<br/><br/>
								<p:commandButton value="Schüler-Passwörter zurücksetzen" action="#{nutzerUpdate.resetSchuelerPassword}" onstart="PF('overlayCalc').show()" oncomplete="PF('overlayCalc').hide()" update="message" icon="fa fa-key">
									<p:confirm header="Bestätigung" message="Das Passwort wird auf 'schule' zurückgesetzt. Dies betrifft alle Schüler. Fortfahren?" icon="ui-icon-alert" />
								</p:commandButton>
							</h:form>
					    </div>
					    
					</div>
					
					<h:panelGroup layout="block" rendered="#{not empty nutzerUpdate.tabelle}">
						<br/><br/>
					</h:panelGroup>
					
					<p:dataTable id="tableNutzer" value="#{nutzerUpdate.tabelle}" var="r" emptyMessage="Keine Nutzer gefunden"
									scrollRows="15" scrollable="true" liveScroll="true" scrollHeight="500"
									rendered="#{not empty nutzerUpdate.tabelle}">
	
			   			<p:column headerText="Vorname">
			   				#{r.nutzer.vorname}
			   			</p:column>
			   			
			   			<p:column headerText="Nachname">
			   				#{r.nutzer.nachname}
			   			</p:column>
			   			
			   			<p:column headerText="E-Mail" style="width:260px">
			   				#{r.nutzer.email}
			   			</p:column>
			   			
			   			<p:column headerText="Klasse" style="width:70px;text-align:center">
			   				#{r.nutzer.klasse}
			   			</p:column>
			   			
			   			<p:column headerText="Speicher" style="width:80px;text-align:center">
			   				#{r.speicherString}
			   			</p:column>
			   			
			   			<p:column headerText="Aktionen" style="width:120px;text-align:center">
		   					<p:commandButton value="Öffnen" action="#{nutzerUpdate.select(r)}" update="updateNutzer" icon="ui-icon-wrench"
		   									onstart="PF('overlayLoad').show()" oncomplete="PF('overlayLoad').hide();PF('overlayEinstellungen').show();"/>
			   			</p:column>
	    			</p:dataTable>
					<br/>
	<!-- Ab hier beginnt Panel: Nutzer ausgewählt -->
					<p:dialog id="panelEinstellungen" header="#{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}" widgetVar="overlayEinstellungen" modal="true" resizable="false" closeOnEscape="true">
						
						<p:messages id="messageText" showDetail="true" closable="true" />
						
						<h2 class="title" style="color:#4c4c4c;">Eigenschaften</h2>
						
						<div class="ui-g">
				    		<div class="ui-g-3">
				    			<p:commandButton value="Daten" action="#{nutzerUpdate.resetNutzerData}" oncomplete="PF('overlayData').show()" update="panelData"/>
				    		</div>
				    		<div class="ui-g-3">
				    			<p:commandButton value="Rechte" action="#{nutzerUpdate.loadRechte}" oncomplete="PF('overlayRechte').show()" update="panelRechte"/>
				    		</div>
				    		<div class="ui-g-6" style="text-align:right">
				    			<p:commandButton value="Nutzer löschen" oncomplete="PF('overlayEinstellungen').hide();PF('overlayDeleteNutzer').show();"
											action="#{nutzerUpdate.prepareDeleteAccount}" update="panelEinstellungen panelDeleteNutzer"/>
				    		</div>
					    </div>
						
						<br/><br/><br/>
						
						<h2 class="title" style="color:#4c4c4c;">Quotas</h2>
						
						<p:commandButton value="Dateien anzeigen" action="#{nutzerUpdate.loadPrivatSpeicher}" oncomplete="PF('overlayPrivatSpeicher').show()" update="panelPrivatSpeicher" style="display:block;margin-top:-44px;margin-left:100px"/>
		    			<p:commandButton value="Speicher leeren" action="#{nutzerUpdate.clearStorage}" oncomplete="PF('overlayEinstellungen').show()" update="messageText panelEinstellungen" style="display:block;margin-top:-27px;margin-left:260px">
		    				<p:confirm header="Bestätigung" message="Der komplette Speicher von #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname} wird gelöscht. Dieser Vorgang kann nicht rückgängig gemacht werden. Fortfahren?" icon="ui-icon-alert" />
		    			</p:commandButton>
						<br/><br/>
						<p:outputLabel value="#{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname} hat #{nutzerUpdate.selectedZeile.speicherUsedString} von #{nutzerUpdate.selectedZeile.speicherString} belegt" />
						<br/><br/><br/>
						<h:form>
							neuer Speicherplatz:
							<p:inputText value="#{nutzerUpdate.storageString}" size="10"/>
							<p:selectOneMenu value="#{nutzerUpdate.sizeType}" style="width:150px;margin-left:10px" effect="none">
								<f:selectItem itemLabel="Größe festlegen" itemValue="" noSelectionOption="false" />
								<f:selectItems value="#{nutzerUpdate.sizes}" />
							</p:selectOneMenu>
							<br/><br/>
			    			
			    			<div style="text-align:center">
			    				<p:commandButton value="Speicherplatz ändern" action="#{nutzerUpdate.editStorage}" oncomplete="PF('overlayEinstellungen').show()" update="messageText updateNutzer"/>
			    			</div>
					    	
						</h:form>
						<br/><br/>
					</p:dialog>
	<!-- Ab hier beginnt Panel: Nutzer ausgewählt/Rechte -->
					<p:dialog id="panelRechte" header="#{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}" widgetVar="overlayRechte" modal="true" resizable="false" closeOnEscape="true" width="650">
						
						<p:messages id="messageTextRechte" showDetail="true" closable="true" />
						
						<h2 class="title" style="color:#4c4c4c;text-align:center">Rechte von #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}</h2>
						
						<h:panelGrid id="innerPanelRechte" columns="2" style="margin-left: auto;margin-right: auto;">
							Login
							<p:commandButton value="#{nutzerUpdate.selectedZeile.loginString}" oncomplete="PF('overlayRechte').show()" action="#{nutzerUpdate.toggleSperrung}" update="messageTextRechte innerPanelRechte" style="margin-left:40px"/>
							Projekte erstellen
							<p:commandButton value="#{nutzerUpdate.selectedZeile.projektErstellenString}" oncomplete="PF('overlayRechte').show()" action="#{nutzerUpdate.toggleProjektErstellen}" update="messageTextRechte innerPanelRechte" style="margin-left:40px"/>
							Rubriken erstellen
							<p:commandButton value="#{nutzerUpdate.selectedZeile.rubrikErstellenString}" oncomplete="PF('overlayRechte').show()" action="#{nutzerUpdate.toggleRubrikErstellen}" update="messageTextRechte innerPanelRechte" style="margin-left:40px"/>
							Beiträge bearbeiten/genehmigen
							<p:commandButton value="#{nutzerUpdate.selectedZeile.beitragManagerString}" oncomplete="PF('overlayRechte').show()" action="#{nutzerUpdate.toggleBeitragManager}" update="messageTextRechte innerPanelRechte" style="margin-left:40px"/>
							Vertretungsplan verwalten
							<p:commandButton value="#{nutzerUpdate.selectedZeile.vertretungString}" oncomplete="PF('overlayRechte').show()" action="#{nutzerUpdate.toggleVertretung}" update="messageTextRechte innerPanelRechte" style="margin-left:40px"/>		
						</h:panelGrid>
						<br/><br/>
					</p:dialog>
							
	<!-- Ab hier beginnt Panel: Nutzer ausgewählt/Daten -->
					<p:dialog id="panelData" header="#{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}" widgetVar="overlayData" modal="true" resizable="false" closeOnEscape="true" width="400">
						
						<p:ajax event="close" listener="#{nutzerUpdate.search}" update="tableNutzer" oncomplete="PF('overlayEinstellungen').show()"/>
						
						<p:messages id="messageTextData" showDetail="true" closable="true" />
						
						<h2 class="title" style="color:#4c4c4c;text-align:center">Daten von #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}</h2>
						
						<h:form>
							<h:panelGrid columns="2" style="margin-left: auto;margin-right: auto;">
								Vorname:
								<p:inputText value="#{nutzerUpdate.dVorname}" style="margin-left:40px;width:200px" placeholder="unverändert" autocomplete="off" />
								Nachname:
								<p:inputText value="#{nutzerUpdate.dNachname}" style="margin-left:40px;width:200px" placeholder="unverändert" autocomplete="off" />
								E-Mail:
								<p:inputText value="#{nutzerUpdate.dEmail}" style="margin-left:40px;width:200px" placeholder="unverändert" autocomplete="off" />
								Passwort:
								<p:password value="#{nutzerUpdate.dPasswort}" style="margin-left:40px;width:200px" placeholder="unverändert" autocomplete="off" />
							</h:panelGrid>
							<br/>
							<br/>
							<div style="text-align:center">
								<p:commandButton value="Änderungen speichern" oncomplete="PF('overlayData').show()" action="#{nutzerUpdate.saveNutzerData}" update="panelData"/>
							</div>
						</h:form>
						
						<br/><br/>
					</p:dialog>
					
	<!-- Ab hier beginnt Panel: Nutzer ausgewählt/Privatspeicher -->
					<p:dialog id="panelLink" header="Link für die Öffentlichkeit" widgetVar="overlayLink" modal="true" resizable="false" closeOnEscape="true">
							
						<br/>
						Diesen Link kopieren und dann ggf. in einem Beitrag einfügen:
						<br/><br/>
						<p:inputText value="#{nutzerUpdate.selectedLink}" readonly="true" size="80"/>
						<br/><br/>
					</p:dialog>
					
					<ui:insert>
				  		<ui:include src="component_datei_vorschau.xhtml" />
					</ui:insert>
					
					<p:dialog id="panelPrivatSpeicher" header="Privatspeicher: #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}" widgetVar="overlayPrivatSpeicher" resizable="false" closeOnEscape="true">
						
						<!-- damit overlayEinstellungen wieder gefokused wird, damit sofort wieder ESC drücken kann -->
						<p:ajax event="close" listener="#{konfig.toggle}" oncomplete="PF('overlayEinstellungen').hide();PF('overlayEinstellungen').show();"/>
						
						<h2 class="title" style="color:#4c4c4c;">#{nutzerUpdate.selectedZeile.speicherUsedString} von #{nutzerUpdate.selectedZeile.speicherString}</h2>
						
						<br/>
						<h:form>
							
							<p:commandButton id="btnUp" disabled="#{nutzerUpdate.directoryView.root}" action="#{nutzerUpdate.directoryView.upVerzeichnis}" update="@form" icon="fa fa-level-up fa-flip-horizontal"/>
						    <p:tooltip for="btnUp" value="Ebene hoch" position="top"/>
						    <p:outputLabel style="margin-left: 10px" value="#{nutzerUpdate.directoryView.verzeichnisNotEmpty}"/>
							<br/>
							<br/>
							
							<p:scrollPanel id="scroll" mode="native" style="width:1000px;height:400px;">
							
								<p:dataTable style="width:960px;" id="table_speicher" value="#{nutzerUpdate.directoryView.array}" var="r" emptyMessage="Keine Dateien vorhanden">
			
									<p:column headerText="Name" style="text-align: center;">
										<p:commandLink rendered="#{r.ordner}" update="@form" action="#{nutzerUpdate.directoryView.selectOrdner(r)}">
											<h:outputText styleClass="fa fa-folder-open" value=""/>
											<h:outputText value=" #{r.datei_name}" />
										</p:commandLink>
										
										<p:commandLink rendered="#{!r.ordner}" update="panelVorschau" action="#{preview.prepare(r)}" oncomplete="PF('overlayVorschau').show()">
											<h:outputText value=" #{r.datei_name}" />
										</p:commandLink>
									</p:column>
									
									<p:column headerText="Hochladedatum" width="170" style="text-align: center;">
										#{r.datum}
									</p:column>
									
									<p:column headerText="Größe" width="100" style="text-align: center;">
										#{r.size}
									</p:column>
									
									<p:column headerText="öffentlich" width="120" style="text-align:center;">
										<p:outputLabel value="nein" rendered="#{!r.publicity}" />
									    <p:commandButton id="btnLink" rendered="#{r.publicity}" action="#{nutzerUpdate.selectLink(r)}" update="panelLink" oncomplete="PF('overlayLink').show()" icon="fa fa-globe"/>
									</p:column>
									
									<p:column headerText="Aktionen" width="120" style="text-align: center;">
											<p:commandButton id="btnDownload" rendered="#{!r.ordner}" ajax="false" style="margin-right:10px;" icon="fa fa-arrow-down">
												<p:fileDownload value="#{nutzerUpdate.download(r)}" update="table_speicher"/>
											</p:commandButton>
											<p:tooltip for="btnDownload" value="Herunterladen" position="top"/>
											
											<p:commandButton id="btnDelete" action="#{nutzerUpdate.deleteDatei(r)}" oncomplete="PF('overlayEinstellungen').show();PF('overlayPrivatSpeicher').show();" update="panelPrivatSpeicher panelEinstellungen" icon="fa fa-trash" />
											<p:tooltip for="btnDelete" value="Löschen" position="top"/>
										
									</p:column>
					    		</p:dataTable>
							</p:scrollPanel>
						</h:form>
						<br/>
					</p:dialog>
	<!-- Ab hier beginnt Panel: Nutzer löschen -->
					<p:dialog id="panelDeleteNutzer" header="#{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname}" widgetVar="overlayDeleteNutzer" modal="true" resizable="false" closeOnEscape="true">
						
						<h2 class="title" style="color:#4c4c4c;">Nutzer #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname} löschen:</h2>
						
						<br/>
						
						<p:outputLabel style="color:red;" value="Alle Dateien von #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname} werden gelöscht" />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Bilder, die mit Beiträgen verknüpft sind, bleiben auf dem Server." />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Alle unveröffentlichte Beiträge werden gelöscht." />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Veröffentlichte Beiträge zeigen als (vorgenerierten) Autor den Admin." />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Projekte werden ggf. gelöscht, falls #{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname} Projektleiter/in ist." />
						<br/><br/><br/>
						<h:form>
							<h:panelGrid id="input" columns="3" rendered="#{!nutzerUpdate.passwortCorrect}">
								<p:outputLabel value="Ihr Passwort:" />
								<p:password value="#{nutzerUpdate.passwort}" required="true" requiredMessage="Bitte geben Sie einen Passwort ein."/>
								<p:messages showDetail="false"/>
							</h:panelGrid>
							<h:outputText value="&lt;br /&gt;" escape="false" rendered="#{!nutzerUpdate.passwortCorrect}"/>
							<p:commandButton value="Passwort überprüfen" ajax="true" oncomplete="PF('overlayDeleteNutzer').show();" action="#{nutzerUpdate.checkPasswort}" rendered="#{!nutzerUpdate.passwortCorrect}" update="panelDeleteNutzer"/>
							<p:commandButton value="#{nutzerUpdate.selectedZeile.nutzer.vorname} #{nutzerUpdate.selectedZeile.nutzer.nachname} löschen" action="#{nutzerUpdate.deleteAccount}" rendered="#{nutzerUpdate.passwortCorrect}" onclick="PF('overlayDeleteNutzer').hide();" update="@all"/>
						</h:form>
						<br/>
					</p:dialog>
	<!-- Ab hier beginnt Panel: ALLE Schüler löschen -->				
					<p:dialog id="panelDeleteAllNutzer" header="ALLE SCHÜLER/INNEN LÖSCHEN" widgetVar="overlayDeleteAllNutzer" modal="true" resizable="false" closeOnEscape="true">
						
						<h2 class="title" style="color:#4c4c4c;">ALLE Schüler/innen löschen:</h2>
						
						<br/>
						
						<p:outputLabel style="color:red;" value="Alle Dateien von den Schülern/Schülerinnen werden gelöscht" />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Bilder, die mit Beiträgen verknüpft sind, bleiben auf dem Server." />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Alle unveröffentlichte Beiträge werden gelöscht." />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Veröffentlichte Beiträge zeigen als (vorgenerierten) Autor den Admin." />
						<br/><br/>
						<p:outputLabel style="color:red;" value="Projekte werden ggf. gelöscht, falls diese/r Schüler/in Projektleiter/in ist." />
						<br/><br/><br/>
						<h:form>
							<h:panelGrid id="input" columns="3" rendered="#{!nutzerUpdate.passwortCorrect}">
								<p:outputLabel value="Ihr Passwort:" />
								<p:password value="#{nutzerUpdate.passwort}" required="true" requiredMessage="Bitte geben Sie einen Passwort ein."/>
								<p:messages showDetail="false"/>
							</h:panelGrid>
							<h:outputText value="&lt;br /&gt;" escape="false" rendered="#{!nutzerUpdate.passwortCorrect}"/>
							<p:commandButton value="Passwort überprüfen" ajax="true" oncomplete="PF('overlayDeleteAllNutzer').show();" action="#{nutzerUpdate.checkPasswort}" rendered="#{!nutzerUpdate.passwortCorrect}" update="panelDeleteAllNutzer"/>
							<p:commandButton value="Schüler/innen löschen" action="#{nutzerUpdate.deleteAllSchueler}" rendered="#{nutzerUpdate.passwortCorrect}"
													onclick="PF('overlayDeleteAllNutzer').hide();"
													onstart="PF('overlayDelete').show();PF('deleteProgress').start();"
													oncomplete="PF('overlayDelete').hide();PF('deleteProgress').cancel();"
													update="@all"/>
													
													
						
						</h:form>
						<br/>
					</p:dialog>
		<!-- Ab hier beginnt Panel: Quotas klassenweise ändern -->			
					<p:dialog id="panelQuotasKlasse" header="Quotas ändern" widgetVar="overlayQuotasKlasse" modal="true" resizable="false" closeOnEscape="true">
						<p:messages showDetail="true" closable="true"/>
						
						<br/>
						
						<h:form>
							
							<div align="center">
								<h:panelGrid columns="2" cellpadding="5">
										<p:inputText size="5"
											value="#{nutzerUpdate.storageString}"
											requiredMessage="Du musst einen Speicherplatz angeben"/>
										<p:selectOneMenu value="#{nutzerUpdate.sizeType}" effect="none">
											<f:selectItem itemLabel="Größe festlegen" itemValue="" noSelectionOption="false" />
											<f:selectItems value="#{nutzerUpdate.sizes}" />
										</p:selectOneMenu>
										
								</h:panelGrid>
								<br/><br/>
								für folgende Klassen:
								<br/><br/>
								<p:selectCheckboxMenu value="#{nutzerUpdate.selectedKlassen}" style="width:300px" label="Klassen" multiple="true">
									<f:selectItems value="#{nutzerUpdate.klassen}"/>
								</p:selectCheckboxMenu>
								<br/><br/>
								
								<p:outputLabel value="Alle "/>
								<p:outputLabel value="Schüler/innen" style="font-weight:bold"/>
								<p:outputLabel value=" in den ausgewählten Klassen bekommen einen neuen Speicherlimit."/>
								<br/>
								<p:outputLabel value="Falls ein Nutzer den Limit überschreitet,"/>
								<br/>
								<p:outputLabel value="werden "/>
								<p:outputLabel value="ALLE Dateien" style="font-weight:bold"/>
								<p:outputLabel value=" im Privat-/Klassen-/Projektspeicher gelöscht!"/>
								<br/><br/><br/>
								
								<p:commandButton value="Quotas aktualisieren" action="#{nutzerUpdate.editStorageKlasse}" oncomplete="PF('overlayQuotasKlasse').show();" update="updateNutzer panelQuotasKlasse" />
							</div>
							
						</h:form>
						<br/>
					</p:dialog>
					
				</p:panel>
				
				<br/><br/><br/>
				
	<!-- Ab hier beginnt Panel: URL-Analyse -->
				
				<p:panel header="Datei-Analyse">
					<br/>
					
						<p:tabView>
					        <p:tab title="URL">
					        	<h:form>
						        	<p:inputText value="#{dateiAnalyse.url}" placeholder="#{dateiAnalyse.placeholder}" style="width:670px"/>
							        <p:commandButton value="URL Analysieren" action="#{dateiAnalyse.analyseURL}" update="result" style="margin-left:10px;"/>
							        <br/>
						        </h:form>
					        </p:tab>
					        
					        <p:tab title="Datei-ID">
					        	<h:form>
						        	<p:inputText value="#{dateiAnalyse.id}" placeholder="ID" style="width:680px"/>
							        <p:commandButton value="ID Analysieren" action="#{dateiAnalyse.analyseID}" update="result" style="margin-left:10px;"/>
							        <br/>
						        </h:form>
					        </p:tab>
					    </p:tabView>
				    
				    <br/>
				    
				    <h:panelGroup id="result" layout="block">
					    <h:panelGroup layout="block" rendered="#{dateiAnalyse.noResult}">
					        <div style="text-align:center">
					        	<p:outputLabel style="color:red;" value="Kein Ergebnis" />
					        </div>
				        </h:panelGroup>
				        
				        <h:panelGroup layout="block" rendered="#{!dateiAnalyse.noResult and dateiAnalyse.found}">
					        <div class="ui-g">
						        <div class="ui-g-7 ui-g-nopad">
						    		<div class="ui-g-4">
						    			<br/><p:outputLabel value="Dateiname:"/>
						    		</div>
						    		<div class="ui-g-8">
						    			<br/><p:outputLabel value="#{dateiAnalyse.datei.datei_name}"/>
						    		</div>
						    		<div class="ui-g-4">
						    			<br/><p:outputLabel value="Nutzer:"/>
						    		</div>
						    		<div class="ui-g-8">
						    			<br/><p:outputLabel value="#{dateiAnalyse.datei.eigtum}"/>
						    		</div>
						    		<div class="ui-g-4">
						    			<br/><p:outputLabel value="Hochladedatum:"/>
						    		</div>
						    		<div class="ui-g-8">
						    			<br/><p:outputLabel value="#{dateiAnalyse.datei.datum}"/>
						    		</div>
						    		<div class="ui-g-4">
						    			<br/><p:outputLabel value="Größe:"/>
						    		</div>
						    		<div class="ui-g-8">
						    			<br/><p:outputLabel value="#{dateiAnalyse.datei.size}"/>
						    		</div>
					    		</div>
					    		<div class="ui-g-5" style="text-align:center">
					    			<br/>
					    			<h:graphicImage value="images/?id=#{dateiAnalyse.datei.datei_name_mit_id}" alt="#{dateiAnalyse.datei.datei_name}" rendered="#{dateiAnalyse.datei.image}"
					    									title="#{dateiAnalyse.datei.datei_name}" width="360"/>
					    									
					    			<h:panelGroup layout="block" rendered="#{dateiAnalyse.datei.pdf}">
						    			<object type="application/pdf" data="public/?file=#{dateiAnalyse.datei.datei_name_mit_id}" height="300px" width="100%">
		            						<br/><br/>Ihr Browser unterstützt kein PDF.<br/><br/><a href="public/?file=#{dateiAnalyse.datei.datei_name_mit_id}" target="_blank">Download der PDF-Datei</a>
		        						</object>
	        						</h:panelGroup>
	        						
	        						<h:panelGroup layout="block" style="text-align:center" rendered="#{dateiAnalyse.datei.video}">
										<video width="360" height="206" controls="controls">
											<source src="public/?file=#{dateiAnalyse.datei.datei_name_mit_id}" type="#{preview.datei.mime}" />
										</video> 
										
									</h:panelGroup>
									
									<h:panelGroup layout="block" style="text-align:center" rendered="#{dateiAnalyse.datei.audio}">
										<br/><br/><br/>
										<audio style="width: 360px;" controls="controls">
											<source src="public/?file=#{dateiAnalyse.datei.datei_name_mit_id}" type="#{preview.datei.mime}" />
										</audio>
									</h:panelGroup>
	        						
	        						<h:panelGroup layout="block" rendered="#{!dateiAnalyse.datei.pdf and !dateiAnalyse.datei.image and !dateiAnalyse.datei.video and !dateiAnalyse.datei.audio}">
		            						<br/><br/>Keine Vorschau möglich.<br/><br/><a href="public/?file=#{dateiAnalyse.datei.datei_name_mit_id}" target="_blank">Download</a>
	        						</h:panelGroup>
					    		</div>
				    		</div>
			    		</h:panelGroup>
				    </h:panelGroup>
		    		
		    		<br/>
				</p:panel>
				
				<br/><br/><br/>
				
				<p:panel header="Speicherverbrauch">
					<br/>
					Hier sehen Sie den Speicherverbrauch von jedem einzelnen Nutzer.
					<br/>
					Sie können auf einen Nutzer klicken, um weitere Informationen einzusehen.
					<br/>
					Hinweis: Der belegter Speicherplatz ist die Summe aus Privat-, Klassen- und Projektspeicher.
					<br/><br/>
					<p:dataTable value="#{nutzerAnalysis.speicherverbrauch}" var="r" emptyMessage="Keine Einträge vorhanden"
									scrollRows="15" scrollable="true" liveScroll="true" scrollHeight="300">
								
						<p:column headerText="Nutzer" style="text-align:center">
							<p:commandLink action="#{nutzerAnalysis.select(r.nutzer)}" update="updateNutzer"
												onstart="PF('overlayLoad').show()" oncomplete="PF('overlayLoad').hide();PF('overlayEinstellungen').show();">
								<h:outputText value="#{r.nutzer.vorname} #{r.nutzer.nachname}" />
							</p:commandLink>
						</p:column>
					
						<p:column headerText="belegter Speicherplatz" style="text-align:center">
							#{r.speicher}
						</p:column>
					</p:dataTable>
					<br/><br/>
				</p:panel>
				
				<br/><br/><br/>
				
	<!-- Ab hier beginnt Panel: Nutzer importieren -->
			
				<p:panel id="importNutzer" header="Nutzerdaten importieren">
					<br/>
					Hier können Sie Nutzerdaten importieren und aktualisieren.
					<br/><br/>
					<h:form>
						<p:outputLabel value="Syntax: " style="font-weight: bold;" />
						
						<p:selectOneMenu value="#{nutzerImport.type}" style="width:760px;margin-left:30px" effect="none">
							<p:ajax listener="#{nutzerImport.updateType}" update="bsp settings" />
							<f:selectItem itemLabel="Syntax auswählen" itemValue="" noSelectionOption="false" />
							<f:selectItems value="#{nutzerImport.types}" />
						</p:selectOneMenu>
						<br/>
						<br/>
						<p:outputLabel value="Trennzeichen: " style="font-weight: bold;" />
						<p:selectOneMenu value="#{nutzerImport.trenner}" style="width:200px;margin-left:30px" effect="none">
							<p:ajax listener="#{nutzerImport.updateType}" update="bsp settings" />
							<f:selectItems value="#{nutzerImport.trenners}" />
						</p:selectOneMenu>
						<br/>
						<br/>
						<h:outputLabel value="Beispiel:" style="font-weight: bold;" />
						<h:outputLabel id="bsp" style="position:relative; left: 50px" value="#{nutzerImport.beispiel}" escape="false" />
						
						<br/><br/>
						
						<p:inputTextarea value="#{nutzerImport.data}" rows="20" style="width:98%" autoResize="false" />
							
						<br/><br/>
						
						<h:panelGroup id="settings" layout="block">
							<h:panelGrid columns="2" style="float:right">
								<p:outputLabel value="Standardpasswort:"/>
								<p:inputText value="#{nutzerImport.standardPassword}" style="width:180px;margin-left:20px;text-align:center" disabled="#{nutzerImport.typeIndex eq 0}"/>
								
								<p:outputLabel value="Rang der eingegebenen Nutzer:" />
								<p:selectOneMenu value="#{nutzerImport.rang}" effect="none" style="margin-left:20px">
									<f:selectItem itemLabel="Rang auswählen" itemValue="" noSelectionOption="false" />
									<f:selectItems value="#{nutzerImport.rangArray}" />
								</p:selectOneMenu>
							</h:panelGrid>
							
							<br/><br/><br/><br/>
							
							<p:commandButton value="Nutzerdaten aktualisieren" 
										onstart="PF('overlayImport').show();PF('importProgress').start();PF('buttonUpdate').disable();"
										oncomplete="PF('overlayImport').hide();PF('importProgress').cancel();PF('buttonUpdate').enable();"
										action="#{nutzerImport.updateData}" update="message importNutzer"
										widgetVar="buttonUpdate"
										style="float:right"/>
										
							<br/><br/>
								   
							
						</h:panelGroup>
					</h:form>
						
					<br/><br/>
					
				</p:panel>
				
				<br/><br/>
				
				<p:dialog widgetVar="overlayLoad" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
					<h2 class="title" style="text-align:center">Lädt...</h2>
				    <p:graphicImage url="resources/img/ajax-loader.gif" />
				</p:dialog>
				<p:dialog widgetVar="overlayCalc" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
					<h2 class="title" style="text-align:center">Verarbeitung</h2>
				    <p:graphicImage url="resources/img/ajax-loader.gif" />
				</p:dialog>
				<p:dialog widgetVar="overlayDelete" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
					<h2 class="title" style="text-align:center">Löschen...</h2>
					<p:progressBar widgetVar="deleteProgress" style="width:400px" ajax="true" value="#{nutzerUpdate.percent}" labelTemplate="{value}%" global="false" />
				</p:dialog>
				<p:dialog widgetVar="overlayImport" modal="true" draggable="false" closable="false" resizable="false" showHeader="false">
					<h2 class="title" style="text-align:center">Verarbeitung</h2>
				    <p:progressBar widgetVar="importProgress" style="width:400px" ajax="true" value="#{nutzerImport.percent}" labelTemplate="{value}%" global="false" />
				</p:dialog>
			</p:panel>
			<br/>
			<div id="bottom">
				<h:link outcome="kontakt" styleClass="ui-link ui-widget" style="font-size:10pt;color:#125100;text-decoration:none;" value="Kontakt"/>
				<p:outputLabel style="font-size:10pt" value=" | "/>
				<h:link outcome="impressum" styleClass="ui-link ui-widget" style="font-size:10pt;color:#125100;text-decoration:none;" value="Impressum"/>
				<p:outputLabel style="font-size:10pt" value=" | "/>
				<h:link outcome="sitemap" styleClass="ui-link ui-widget" style="font-size:10pt;color:#125100;text-decoration:none;" value="Sitemap"/>
				<br/><br/>
				<h:outputText style="font-size:12pt;word-wrap: break-word;" escape="false" value="#{konfig.bottomText}"/>
			</div>
			<br/>
		</div>
	</h:body>
</html>